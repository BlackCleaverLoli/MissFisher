# 钓法表达式（Angle Expression）  
> 本文默认读者已经掌握《最终幻想14》中的基本操作和钓鱼玩法的各种基本要点。  
  
# 本文还未完工  
# 部分使用英文输入法的特性还未适配  
  
## 什么是钓法表达式？  
  
钓法表达式是一段用来描述 FF14 钓鱼策略的文本规则，由简化的关键字和符号组成。  
你可以用极简的文本，写出在不同场景和目标下的钓法。  
对 MissFisher 来说，它就是一段可执行的指令：让 MissFisher 按你写的规则自动钓鱼。  
  
### 怎么用钓法表达式？  
在已经启用 MissFisher 时，在游戏的聊天窗口（消息窗口）输入这样的命令：  
```  
/mf <angex>  
```  
例如钓法表达式是 `平钓》！！！`，那么：  
```  
/mf 平钓》！！！  
```  
  
又或者，你可以在 MissFisher 的钓法[表达式编辑器](#01-钓法表达式编辑器)中启动。  
  
# 0. 开始  
  
## 0.1 钓法表达式编辑器
在 MissFisher 主界面找到 预设 页签，选择它，点击 切换 就能从钓法表达式生成器切换到钓法表达式编辑器。  
  
钓法表达式编辑器可以：  
  
- 即时校验钓法表达式是否合法  
- 将单行的钓法表达式按结构添加换行和缩进使其在编辑时更有可读性  
  
## 0.2 游戏条件  
游戏进度：已可游玩 7.00 补丁的内容，以便测试  
捕鱼人：需要已经满级，且已经学习技能 耐心II  
  
## 0.3 常测的钓场  
**永夏岛北：**  
位置：拉诺西亚-东拉诺西亚，地图东北方的岛屿周围。  
在使用「沙蚕」作为钓饵时，永夏岛北有最稳定的咬饵。在抛竿后，咬饵的必定是「梅尔托尔虾虎」，在使用「梅尔托尔虾虎」来以小钓大后，咬饵的必定是「梭子鰆」。  
  
**深壕：**  
位置：北洋地域-迷津，地图中央的围绕圆形地图块的沟渠。  
在用「以太螯虾」来以小钓大后，咬饵的仍可能是「以太螯虾」。可以测试「以小钓大循环」和捕鱼人之识。  
  
**圣法斯里克天庭：**  
位置：诺弗兰特-伊尔美格，地图东南方的区域的河流。  
测试条件：有一把「诺弗兰特远见钓竿」（莫雯工具，物品 ID 41190），你需要装上前述的钓竿才能钓上测试所需的鱼类。  
在这里非常容易测试捕鱼人之识和捕鱼人之识结束时的确保咬饵效果。只需要钓上3条「丰饶虹鳉」就能触发对应「圣法斯里克的石头脑袋」的捕鱼人之识。  
  
# 1. 基本结构  
一条最简的钓法表达式由以小钓大模式关键字、阶段起始符和阶段参数组成。  
  
- 例如：  
  - 表示钓法：撒饵、然后抛竿，对 `!` 提钩。  
```angex  
平钓》！  
nm > !  
```  
  
  
## 2. 模式  
## 2.1 平钓  
> 普通的抛竿  
  
在钓法表达式中，可以用 `平钓` / `nm` 表示在这段钓法中不需要任何提升鱼类大尺寸概率的技能，也就是说只需要抛竿，目标鱼类就有可能咬饵。  
  
例如钓场「红茶川水系下游」的钓场之王「酿血鱼」（ID 7696），它的钓法在各种钓法攻略/工具中常这样表示：  
  
「蝲蛄丸子」→ `!!!` 「酿血鱼」  
  
这意味着你只需要给鱼钩挂上「蝲蛄丸子」，然后抛竿，就有可能有 `!!!` 类型的咬饵。  
  
针对这种钓法，我们可以这样写：  
  
- 先写模式关键字：`平钓` / `nm`  
  - 表示在钓法中不使用提高大尺寸概率的技能，例如大鱼猎手或耐心系技能。  
```angex  
平钓  
nm  
```  
  
- 然后使用阶段起始符引入阶段参数：`》` / `>`  
  - 每个「阶段」都必须使用阶段起始符来引入参数  
  - 通常来说，每次「从头开始」的抛竿和以小钓大，都算作一个单独的阶段  
  - 参数之间的空格不是必须的  
```angex  
平钓》  
nm >  
```  
  
- 最后加上表示咬饵类型的符号  
  - 在这里，我们使用 3 个 `！` / `!` 来表示对应「酿血鱼」的咬饵类型：`！！！` / `!!!`  
```angex  
平钓》！！！  
nm > !!!  
```  
表示钓法：撒饵、然后抛竿，对 `!!!` 提钩。  

> [!tip]
> **- 助记：**
> `平钓` / `nm` = 普通的抛竿
  
## 2.2 大鱼
> 大鱼猎手

在钓法表达式中，用 `大鱼` / `bf` 来表示在钓法中需要使用大鱼猎手，来提高获得大尺寸鱼类的概率。

**- 通常而言在以下场景使用：**
目标鱼类需要进行 1 次以小钓大后才会咬饵；
目标鱼类是仅抛竿就能钓到的收藏品。



- `大鱼` / `bf`  
  - 这个关键字表示技能 大鱼猎手  
  - 通常而言，我们会在目标鱼类需要 1 次以小钓大时使用这个关键字  
  - 其他的使用场景：  
    - 用来以小钓大的鱼类的咬饵比较好辨认、  
  
  
- 道具：钓饵 沙蚕 和 万能拟饵，沙蚕 准备数百个、万能拟饵 数个  
- 钓场：前往钓场 永夏岛北  
  
## 术语  
  
  
|  游戏机制   | 描述                                                                       |  
|:-------:|--------------------------------------------------------------------------|  
|  耐心系技能  | 指耐心和耐心II                                                                 |  
| 以小钓大系技能 | 指以小钓大和以小钓大II                                                             |  
| 以小钓大机会  | 可使用不同的以小钓大系技能                                                            |  
|  以小钓大链  | 由可以小钓大的鱼和使用以小钓大钓到的鱼组成的链                                                  |  
| 以小钓大循环  | 以小钓大链中的局部循环<br/>某些鱼类在被用来以小钓大时，相同的鱼类会咬饵                                   |  
|   稀有度   | 鱼类物品图标的背景色，稀有度从低到高：白/灰（无背景色）→绿→蓝                                         |  
|   尺寸    | 鱼类的属性，与稀有度无关                                                             |  
|  大尺寸鱼类  | 钓到时会获得与钓到的鱼类数量相同的捕鱼人之计层数<br/>若钓到的鱼类可被用来以小钓大，且尺寸到达一定数值，则可使用以小钓大来消耗其进行以小钓大 |  
  
SE 定义的技能类别：  
  
| 技能类别 | 包含                                                                  |  
|:----:|---------------------------------------------------------------------|  
|  基础  | 选饵、抛竿、提钩、中断、歇竿、垂钓之光                                                 |  
|  准备  | 耐心、耐心II、大鱼猎手、大鱼的知识、以小钓大、以小钓大II、熟练渔技、熟练妙招、撒饵、钓组、鱼眼、拍击水面、专一垂钓、放生、放生列表 |  
|  提钩  | 强力提钩、精准提钩、双重提钩、三重提钩                                                 |  
|  诱饵  | 雄心之饵、谦逊之饵                                                           |  
|  其他  | 隐行、沙利亚克的恩宠、收藏品采集                                                    |  
  
  
|  程序定义  | 描述                                                                                                                                                                                   |  
|:------:|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|  
|  准备状态  | 抛竿或以小钓大前的状态，角色此时可使用准备技能                                                                                                                                                              |  
| 等待咬饵状态 | 抛竿或以小钓大后的状态，角色此时可使用提钩技能、诱饵技能以及部分基础技能与部分其他技能                                                                                                                                          |  
| 以小钓大阶段 | 上一个等待咬饵状态的开始到下一个等待咬饵阶段的开始的时间段，被视为一个完整的以小钓大阶段。<br/>共有 4 个以小钓大阶段：从 0 到 3<br/>每次以小钓大系技能被使用都会将以小钓大阶段推进 1；<br/>不带游动饵的抛竿被使用都会将以小钓大阶段重置到 0；<br/>带游动饵的抛竿将使以小钓大阶段被设为该游动饵被存为游动饵前的鱼类的以小钓大阶段加 1。 |  
  
---  
  
## 词法单元  
  
### 操作符、定界符与分隔符  
  
  
|         中文输入法          |         英文输入法          |     类型     | 描述                       |  
|:----------------------:|:----------------------:|:----------:|--------------------------|  
|          `》`           |          `>`           | 钓法参数引入操作符  | 表示抛竿后参数的开始               |  
|          `+`           |          `+`           | 特殊参数连接分隔符  |  连接不同状态下咬饵时间的区间端点或咬饵类型标记 |  
|        `-` `~`         |        `-` `~`         |  数字连接分隔符   | 连接数字                     |  
|         `【 】`          |         `[ ]`          |  物品集合定界符   | 包裹物品参数                   |  
|          `\|`          |          `\|`          |  别名连接分隔符   | 连接物品的名称和 ID              |  
|          `、`           |         `\|\|`         |  集合元素分隔符   | 分隔集合中的元素                 |  
|          `=`           |          `=`           | 全局参数起始操作符  |                          |  
|          `；`           |          `;`           |  全局参数分隔符   |                          |  
|          `@`           |          `@`           |   触发器操作符   | 满足特定条件时执行触发器操作符后的操作      |  
|         `（ ）`          |         `( )`          |  特殊集合定界符   | 包裹特定参数                   |  
|          `？`           |          `?`           |  排除集合操作符   |                          |  
|          `《`           |          `<`           |   游动饵操作符   |                          |  
|          `=》`          |          `=>`          | 嵌套表达式引入操作符 |                          |  
|          `《=`          |          `<=`          | 嵌套表达式闭合操作符 |                          |  
  
### 关键字  
  
#### 触发类型关键字  
  
| 中文输入法 | 英文输入法 | 描述 |  
|:-----:|:-----:|----|  
| `拍水`  | `ss`  |    |  
| `专一`  | `ic`  |    |  
| `阶段`  | `stg` |    |  
| `鱼识`  | `int` |    |  
| `拍水后` | `pss` |    |  
  
#### 物品集合关键字  
  
| 中文输入法 | 英文输入法 | 描述 |  
|:-----:|:-----:|----|  
| `任何`  | `any` |    |  
| `占位`  | `ph`  |    |  
  
#### 提钩类型关键字  
  
| 中文输入法 | 英文输入法 | 描述     |  
|-------|-------|--------|  
| `强力`  | `pw`  | 使用强力提钩 |  
| `精准`  | `pc`  | 使用精准提钩 |  
| `双提`  | `dh`  | 使用双重提钩 |  
| `双重`  | `dh`  | 使用双重提钩 |  
| `三提`  | `th`  | 使用三重提钩 |  
| `三重`  | `th`  | 使用三重提钩 |  
| `华丽`  | `sh`  | 使用华丽提钩 |  
  
  
---  
  
# 开始学习  
##  验证钓法表达式  
使用正则表达式对钓法表达式进行词法与结构合法性检查：[Regex101: Angex Latest](https://regex101.com/r/gA6Cow)  
  
## 测试环境  
当需要测试钓法表达式时，建议的钓场：  
- 永夏岛北  
  - 拉诺西亚 - 东拉诺西亚（36.0, 26.6）[在鱼糕上的永夏岛北](https://fish.ffmomola.com/#/wiki/fishing/spot/156)  
  - 在永夏岛北使用沙蚕钓鱼时，能获得极其稳定的以小钓大链：  
    在抛竿后，咬饵的总是梅尔托尔虾虎，使用梅尔托尔虾虎以小钓大时，咬饵的总是罗敏萨鳀鱼。且该钓场有所有咬饵类型，且包括必须在特定条件才能钓到的鱼类。  
  
# 0. 基本语法与结构  
钓法表达式应从左到右在同一行书写；空格 ` ` 在钓法表达式中无语义。  
  
基本结构如下，按顺序排列。  
  
- 其中 `< >` 表示必须结构，`[ ]` 表示可选结构，`|` 分割在同一参数位的不同参数。  
  - 这些符号在此仅作结构说明，而不属于钓法表达式的一部分：  
```text  
<模式、钓饵与窗口期> <抛竿后钓法> [终止目标、计数器与修饰词] [嵌套的钓法表达式] [注释]  
```  
  
- 模式、钓饵与窗口期参数的结构：  
```text  
<模式关键字> [钓饵] [ET 窗口期] [天气窗口期]  
```  
  
- 抛竿后钓法参数的结构：  
```text  
<抛竿后第 1 次以小钓大前的钓法> [第 1 次以小钓大后的钓法] [第 2 次以小钓大后的钓法] [第 3 次以小钓大后的钓法]  
```  
  
- 终止目标、计数器与钓法修饰关键字的结构：  
```text  
[终止目标] [计数器 1] [计数器 2] [计数器 3] [钓法修饰关键字]  
```  
  
- 嵌套的钓法表达式参数的结构：  
  
```text  
[计数器满足时切换的钓法表达式] [获得鱼识或拍击水面时切换的钓法表达式]  
```  
  
## 0.1 使用不同的输入法书写  
钓法表达式可使用中文输入法或英文输入法来书写；表示相同词法单元的不同字符变体在语义上等效。  
  
## 0.2 必须结构  
  
一条完整的钓法表达式必须至少由以下部分组成：  
必须以 [模式关键字](#1-模式关键字) 开始、然后是 [钓法参数引入操作符](#2-钓法参数引入操作符)、然后是 [咬饵类型符 或 咬饵类型关键字](#3-咬饵类型)。  
  
- 一个最简的例子：这样写，MissFisher 将在准备状态使用抛竿，并在任何类型的咬饵提示出现时使用提钩。  
```angex  
平钓》全部  
nm > all  
```  
  
# 1. 模式关键字  
钓法表达式必须以模式关键字开始。  
  
MissFisher 将因为不同的模式关键字而在钓鱼的准备状态使用不同的技能，采取的钓鱼策略也将不同。  
  
  
| 中文输入法 | 英文输入法 | 描述                |  
|:-----:|:-----:|-------------------|  
| `平钓`  | `nm`  | 不使用增加钓到大尺寸鱼类概率的技能 |  
| `大鱼`  | `bf`  | 使用大鱼猎手来捕获大尺寸鱼类    |  
| `耐心`  | `pt`  |  使用耐心系技能来捕获大尺寸鱼类  |  
  
# 2. 钓法参数引入操作符  
使用 `》` 或 `>` 作为不同以小钓大阶段的钓法参数的引入操作符。  
  
- 这样写，MissFisher 将在准备状态使用抛竿，并在任何类型的咬饵提示出现时使用提钩。  
```angex  
平钓》全部  
nm > all  
```  
  
> 助记：你可以将其看作一个箭头，每个 `》` 表示一次抛竿或以小钓大，指向抛竿或以小钓大后的钓法参数。  
  
## 2.1 以小钓大  
在抛竿后的钓法参数后使用第 2 个 `》` 或 `>` 来引入以小钓大后的钓法参数。  
  
- 这样写，MissFisher 将在准备状态使用抛竿，在任何类型的咬饵提示出现时使用提钩；  
 并在以小钓大系技能可用时以小钓大，然后在以小钓大后对 `!!` 使用提钩。  
```angex  
大鱼》全部》！！  
bf > all > !!  
```  
  
## 2.2 以小钓大循环  
> 搜索关键词：套娃  
  
当钓到的鱼类与先前用来以小钓大的鱼类相同时，MissFisher 将会使用上一次以小钓大前的钓法参数。  
  
- 假如会导致以小钓大循环的鱼类的咬饵标记是 `!!`，只需要将相同的咬饵类型标记加入下一个 `》` 或 `>` 后的钓法参数中，即可处理包含以小钓大循环的以小钓大链。  
```angex  
耐心》！！》！！+！！！  
pt > !! > !! + !!!  
```  
  
# 3. 咬饵类型  
> 搜索关键词：竿型、杆  
## 3.1 咬饵类型标记  
`！` 或 `!` 是组成咬饵类型标记的最小标记单位。咬饵类型标记与游戏中的咬饵事件发生时，角色模型上方出现的 `!` 标记直接对应。  
  
| 中文输入法  | 英文输入法 | 描述          |  
|:------:|:-----:|-------------|  
|  `！`   |  `!`  | 对应 `!` 标记   |  
|  `！！`  | `!!`  | 对应 `!!` 标记  |  
| `！！！`  | `!!!` | 对应 `!!!` 标记 |  
  
- 这样写，MissFisher 将在准备状态使用抛竿，并对 `!!!` 使用提钩。  
```angex  
平钓》！！！  
nm > !!!  
```  
  
## 3.2 使用多个咬饵类型标记  
使用 `+` 作为咬饵类型标记连接符，将多个咬饵类型标记组合成一个集合。  
  
- 这样写，MissFisher 将在准备状态使用抛竿，并对 `!` 或 `!!!` 使用提钩。  
```angex  
平钓》！+！！！  
nm > ! + !!!  
```  
  
- 咬饵类型标记不区分顺序，下面的钓法表达式的语义等效于上一条。  
```angex  
平钓》！！！+！  
nm > !!! + !  
```  
> 建议：为了可读性，编写时建议「从小到大」，即在连接 `！` 和 `！！！` 时，建议写为 `！+！！！`，而非 `！！！+！`  
## 3.3 咬饵类型关键字  
使用 `全部` 或 `any` 作为咬饵类型关键字，它们的语义等效于 `! + !! + !!!`，即响应任意类型的咬饵。  
  
在同一参数位中，不能同时使用咬饵类型标记与咬饵类型关键字。  
  
- 这样写，MissFisher 将在准备状态使用抛竿，并在任意类型的咬饵提示出现时使用提钩。  
```angex  
平钓》全部  
nm > all  
```  
---  
# 4. 钓饵  
在第 1 个 `>` 前使用 `【 】` 或 `[ ]` 作为物品集合定界符包裹钓饵的名称或 ID 作为钓饵参数。  
  
- 如果提供的是物品名称，MissFisher 将尝试使用所在客户端的内部物品表格来转换到 ID。  
- 因此，物品名称应使用钓法表达式将使用的客户端的语言来表示。  
  - 不限大小写；  
  - 如有复数变体，应使用单数形式。  
  
- 这样写，MissFisher 将抛竿前自动换上名称为 `沙蚕` 的钓饵。  
```angex  
平钓【沙蚕】》全部  
nm [ Lugworm ] > all  
```  
  
## 4.1 别名连接分隔符  
可在相同参数位同时使用物品名称与物品 ID；先写名称，然后使用 `|` 连接 ID。  
此时名称将作为提升可读性的字面量；MissFisher 将优先使用 ID，如果 ID 不合法，将尝试转换名称。  
  
- 这样写，MissFisher 将抛竿前自动换上 ID 为 `2585` 的钓饵。  
```angex  
平钓【沙蚕|2585】》全部  
nm [ Lugworm | 2585 ] > all  
```  
  
- **使用 MissFisher 自动添加 ID：**  
  将仅包含对应当前客户端语言的物品名称的钓法表达式复制到剪贴板，然后使用命令 `/MissFisher addid`，MissFisher 将尝试为剪贴板中的集合元素添加 ID。  
  
  
> 除非仅在对应物品名称的语言的客户端使用该钓法表达式，否则编写将公开的钓法表达式时，应在集合中包含 ID。  
---  
# 5. 全局参数  
使用 `=` 作为全局参数的起始操作符；使用 `；` 或 `;` 作为全局参数分隔符。  
## 5.1 终止目标  
在 `=` 后使用 `【 】` 或 `[ ]` 包裹物品名称或物品 ID，然后使用 `；` 或 `;` 来闭合，作为终止目标参数。  
  
MissFisher 将在已钓到符合提供的参数的鱼类时，终止自动钓鱼并报告。  
  
- 这样写，MissFisher 将在钓到 ID 为 `4869` 的鱼类时，终止自动钓鱼并报告。  
```angex  
平钓》全部=【4869】；  
nm > all = [4869];  
```  
  
### 5.1.1 使用多个目标  
使用 `、` 或 `||` 在任意集合定界符中分隔集合中的元素，以在同一参数位列举多个元素。  
  
- 这样写，MissFisher 将在钓到 ID 为 `4869` 或 `20143` 的鱼类时，终止自动钓鱼并报告。  
```angex  
平钓》全部=【4869、20143】；  
nm > all = [4869 || 20143];  
```  
## 5.2 计数器  
在 `=` 后使用数字与目标参数作为计数器参数；最多同时使用 3 个计数器参数。  
  
MissFisher 将在满足所有计数器需求时，终止自动钓鱼并报告。  
  
- 这样写，MissFisher 将在已钓到总计 3 条 ID 为 `4869` 的鱼类时，终止自动钓鱼并报告。  
```angex  
平钓》全部=3【4869】；  
nm > all = 3 [4869];  
```  
  
- 这样写，mf 将在已钓到总计 3 条 ID 为 `4869` 或 `20143` 的鱼类时，终止自动钓鱼并报告。  
```angex  
平钓》全部=3【4869、20143】；  
nm > all = 3 [ 4869 || 20143 ];  
```  
  
- 这样写，MissFisher 将在已钓到以下数量的鱼类时，终止自动钓鱼并报告：1 条 ID 为 `20143` 的鱼类、3 条 ID 为 `4869` 的鱼类、且已钓到 2 条 ID 为 `4897` 的鱼类。  
```angex  
平钓》全部=1【20143】；3【4869】；2【4897】；  
nm > all = 1 [ 20143 ]; 3 [ 4869 ]; 2 [ 4897 ];  
```  
  
### 5.2.1 同时使用计数器与最终目标  
计数器参数可与终止目标参数同时使用，先写终止目标参数，再写计数器参数。  
  
- 这样写，MissFisher 将在钓到 ID 为 `20143` 的鱼类、或已钓到总计 3 条 ID 为 `4869` 的鱼类，终止自动钓鱼并报告。  
```angex  
平钓》全部=【20143】；3【4869】；  
nm > all = [ 20143 ]; 3 [ 4869 ];  
```  
  
## 5.3 钓法修饰关键字  
在 `=`、最终目标参数、与计数器参数后使用不同的钓法修饰关键字作为钓法修饰参数，并使用 `、` 或 `||` 来分隔多个钓法修饰关键字，最后使用 `；` 或 `;` 来闭合。  
  
所有钓法修饰关键字：  
  
| 中文输入法  |    英文输入法     | 描述                                                                     |  
|:------:|:------------:|:-----------------------------------------------------------------------|  
| `不撒饵`  |   `nochum`   | 不使用撒饵                                                                  |  
| `收藏品`  |    `coll`    | 保持技能收藏品采集的状态效果                                                         |  
| `不收集`  |   `nocoll`   | 在当前钓法中禁用 MissFisher 的自动收集收藏品（自动确认）                                     |  
|  `钓组`  |    `snag`    | 保持技能钓组的状态效果                                                            |  
| `大尺寸`  |   `large`    | 配合模式关键字 `大鱼` 或 `bf` 或 `耐心` 或 `pt` 使用，表示使用尽可能钓到大尺寸鱼类的策略                 |  
| `攒鱼计`  |     `aa`     | 配合模式关键字 `耐心` 或 `pt` 使用，用来积攒捕鱼人之计层数；<br/>MissFisher 将在捕鱼人之计满层时终止自动钓鱼并报告 |  
|  `套娃`  | `mooch-loop` | 使用优化策略以优化当以小钓大链含有以小钓大循环时的表现                                            |  
| `等待专一` |   `waitic`   |                                                                        |  
| `大鱼知识` |    `bfg`     |                                                                        |  
|  `引诱`  |    `lure`    |                                                                        |  
|  `雄心`  |   `a-lure`   |                                                                        |  
|  `谦逊`  |   `m-lure`   |                                                                        |  
|  `重随`  |  `re-roll`   |                                                                        |  
|  `鱼影`  |   `shadow`   |                                                                        |  
|  `多提`  |     `mh`     |                                                                        |  
|  `回收`  |    `recy`    |                                                                        |  
|  `鱼眼`  |     `fe`     |                                                                        |  
|  `鱼篓`  |     `sh`     |                                                                        |  
| `鱼篓专一` |   `sh-ic`    |                                                                        |  
| `跳阶段`  |  `skipstg`   |                                                                        |  
|  `银星`  |   `silver`   |                                                                        |  
| `无强心剂` |   `nocord`   |                                                                        |  
  
### 5.3.1 不撒饵  
使用 `不撒饵` 或 `nochum` 在当前钓法中禁用撒饵。  
  
- 这样写，MissFisher 将不使用撒饵。  
```angex  
平钓》全部=不撒饵；  
nm > all = nochum ;  
```  
